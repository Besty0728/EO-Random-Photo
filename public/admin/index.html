<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EdgeOne Random Photo Admin</title>
    <style>
        :root {
            --primary: #007aff;
            --glass-bg: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(255, 255, 255, 0.4);
            --text-main: #1d1d1f;
            --text-sec: #86868b;
            --danger: #ff3b30;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --glass-bg: rgba(0, 0, 0, 0.6);
                --glass-border: rgba(255, 255, 255, 0.1);
                --text-main: #f5f5f7;
                --text-sec: #a1a1a6;
            }
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--text-main);
        }

        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #1c1c1e 0%, #2c2c2e 100%);
            }
        }

        .container {
            width: 90%;
            max-width: 600px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 2.5rem;
            border-radius: 24px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 2rem;
            text-align: center;
            letter-spacing: -0.5px;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-sec);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input[type="text"],
        input[type="password"],
        input[type="number"],
        textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid transparent;
            background: rgba(120, 120, 128, 0.1);
            border-radius: 12px;
            font-size: 16px;
            color: var(--text-main);
            transition: all 0.2s;
            font-family: inherit;
        }

        input:focus,
        textarea:focus {
            outline: none;
            background: rgba(120, 120, 128, 0.15);
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
            line-height: 1.5;
        }

        .switch-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
            margin-bottom: 1.5rem;
        }

        .switch-label {
            display: flex;
            flex-direction: column;
        }

        .switch-desc {
            font-size: 12px;
            color: var(--text-sec);
            font-weight: 400;
            margin-top: 2px;
            text-transform: none;
        }

        /* iOS Style Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 30px;
            appearance: none;
            background: rgba(120, 120, 128, 0.2);
            border-radius: 15px;
            transition: 0.3s;
            cursor: pointer;
            outline: none;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 26px;
            height: 26px;
            background: white;
            border-radius: 50%;
            transition: 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch:checked {
            background: var(--primary);
        }

        .toggle-switch:checked::after {
            transform: translateX(20px);
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.1s, opacity 0.2s;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
        }

        .btn-primary:hover {
            opacity: 0.9;
        }

        .hidden {
            display: none;
            opacity: 0;
        }

        .fade-in {
            animation: fadeIn 0.4s ease forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #message {
            margin-top: 1rem;
            text-align: center;
            font-size: 14px;
            min-height: 20px;
        }

        .success {
            color: #34c759;
        }

        .error {
            color: var(--danger);
        }

        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            background: rgba(120, 120, 128, 0.1);
            color: var(--text-sec);
            margin-left: 8px;
            text-transform: uppercase;
        }
    </style>
</head>

<body>

    <div class="container" id="login-section">
        <h1>Admin Login</h1>
        <div class="input-group">
            <label>Password</label>
            <input type="password" id="password" placeholder="Enter admin password">
        </div>
        <button class="btn btn-primary" onclick="login()">Sign In</button>
        <div id="login-msg" class="error" style="text-align:center; margin-top:10px;"></div>
    </div>

    <div class="container hidden" id="dashboard-section">
        <h1>Dashboard <span id="source-badge" class="badge">Checking...</span></h1>

        <div class="switch-row">
            <div class="switch-label">
                <span style="color:var(--text-main)">Global Public Access</span>
                <span class="switch-desc">Allow anyone to access images without restrictions</span>
            </div>
            <input type="checkbox" id="public-access" class="toggle-switch">
        </div>

        <div class="input-group">
            <label>Whitelist Domains <span style="text-transform:none;opacity:0.6">(Comma separated)</span></label>
            <input type="text" id="whitelist" placeholder="example.com, blog.me">
        </div>

        <div class="input-group">
            <label>Public Images <span style="text-transform:none;opacity:0.6">(One filename per comma)</span></label>
            <textarea id="public-images" placeholder="banner.jpg, logo.png" style="min-height: 80px;"></textarea>
            <div style="font-size:12px;color:var(--text-sec);margin-top:4px">These images bypass hotlink protection.
            </div>
        </div>

        <div class="switch-row">
            <div class="switch-label">
                <span style="color:var(--text-main)">DDoS Defense Mode</span>
                <span class="switch-desc">Enable edge caching and strict referer checks</span>
            </div>
            <input type="checkbox" id="ddos-mode" class="toggle-switch">
        </div>

        <div class="input-group" id="cache-group">
            <label>DDoS Cache Timeout (Seconds)</label>
            <input type="number" id="ddos-cache" value="5" min="1" max="60">
        </div>

        <button class="btn btn-primary" onclick="saveConfig()" id="save-btn">Save Changes</button>
        <div id="message"></div>
    </div>

    <script>
        let authToken = '';

        async function login() {
            const pwd = document.getElementById('password').value;
            if (!pwd) return;

            // Basic "Auth" for demo - using the password itself as token
            authToken = 'Bearer ' + pwd;

            const btn = document.querySelector('#login-section .btn');
            const originalText = btn.innerText;
            btn.innerText = 'Verifying...';
            btn.classList.add('loading');

            try {
                const res = await fetch('/api/admin', {
                    headers: { 'Authorization': authToken }
                });

                if (res.ok) {
                    const config = await res.json();
                    showDashboard(config);
                } else {
                    document.getElementById('login-msg').innerText = 'Invalid Password';
                    authToken = '';
                }
            } catch (e) {
                document.getElementById('login-msg').innerText = 'Network Error';
            } finally {
                btn.innerText = originalText;
                btn.classList.remove('loading');
            }
        }

        function showDashboard(config) {
            document.getElementById('login-section').classList.add('hidden');
            const dash = document.getElementById('dashboard-section');
            dash.classList.remove('hidden');
            dash.classList.add('fade-in');

            // Populate Fields
            document.getElementById('public-access').checked = config.publicAccess;
            document.getElementById('whitelist').value = config.whitelist.join(', ');
            document.getElementById('ddos-mode').checked = config.ddosMode;
            document.getElementById('ddos-cache').value = config.ddosCacheTimeout;
            document.getElementById('public-images').value = (config.publicImages || []).join(', ');

            // Badge
            const badge = document.getElementById('source-badge');
            badge.innerText = config.source + ' Mode';

            // Read-Only Handling
            if (config.source === 'ENV') {
                const elements = document.querySelectorAll('#dashboard-section input, #dashboard-section textarea, #dashboard-section button');
                elements.forEach(el => el.disabled = true);
                document.getElementById('message').innerText = 'ðŸ”’ Read-Only Configuration (Environment Variables)';
                document.getElementById('message').style.color = 'var(--text-sec)';
            }
        }

        async function saveConfig() {
            const btn = document.getElementById('save-btn');
            btn.innerText = 'Saving...';
            btn.classList.add('loading');

            const publicAccess = document.getElementById('public-access').checked;
            const whitelistStr = document.getElementById('whitelist').value;
            const whitelist = whitelistStr.split(',').map(s => s.trim()).filter(s => s);

            const ddosMode = document.getElementById('ddos-mode').checked;
            const ddosCacheTimeout = parseInt(document.getElementById('ddos-cache').value);

            const publicImagesStr = document.getElementById('public-images').value;
            const publicImages = publicImagesStr.split(',').map(s => s.trim()).filter(s => s);

            try {
                const res = await fetch('/api/admin', {
                    method: 'POST',
                    headers: {
                        'Authorization': authToken,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ publicAccess, whitelist, ddosMode, ddosCacheTimeout, publicImages })
                });

                if (res.ok) {
                    showMessage('Configuration Saved Successfully!', 'success');
                } else {
                    const msg = await res.text();
                    showMessage('Failed: ' + msg, 'error');
                }
            } catch (e) {
                showMessage('Network Error: ' + e.message, 'error');
            } finally {
                btn.innerText = 'Save Changes';
                btn.classList.remove('loading');
            }
        }

        function showMessage(msg, type) {
            const el = document.getElementById('message');
            el.innerText = msg;
            el.className = type;
            setTimeout(() => {
                el.innerText = '';
                el.className = '';
            }, 3000);
        }

        // Enter key for login
        document.getElementById('password').addEventListener('keyup', function (event) {
            if (event.key === 'Enter') {
                login();
            }
        });
    </script>
</body>

</html>