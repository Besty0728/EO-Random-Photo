<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EdgeOne Random Photo Admin</title>
    <style>
        :root {
            --primary: #007aff;
            --primary-glow: rgba(0, 122, 255, 0.4);
            --glass-bg: rgba(255, 255, 255, 0.75);
            --glass-border: rgba(255, 255, 255, 0.5);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --text-main: #1d1d1f;
            --text-sec: #86868b;
            --danger: #ff3b30;
            --success: #34c759;
            --bg-gradient-1: #667eea;
            --bg-gradient-2: #764ba2;
            --bg-gradient-3: #f093fb;
            --bg-gradient-4: #f5576c;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --glass-bg: rgba(30, 30, 32, 0.8);
                --glass-border: rgba(255, 255, 255, 0.1);
                --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
                --text-main: #f5f5f7;
                --text-sec: #a1a1a6;
                --bg-gradient-1: #1a1a2e;
                --bg-gradient-2: #16213e;
                --bg-gradient-3: #0f3460;
                --bg-gradient-4: #533483;
            }
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--text-main);
            overflow: hidden;
            position: relative;
        }

        /* åŠ¨æ€æ¸å˜èƒŒæ™¯ */
        .bg-gradient {
            position: fixed;
            inset: 0;
            background: linear-gradient(-45deg, var(--bg-gradient-1), var(--bg-gradient-2), var(--bg-gradient-3), var(--bg-gradient-4));
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            z-index: -2;
        }

        @keyframes gradientShift {

            0%,
            100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

        /* æµ®åŠ¨è£…é¥°åœ† */
        .floating-orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.5;
            z-index: -1;
            animation: float 20s ease-in-out infinite;
        }

        .orb-1 {
            width: 300px;
            height: 300px;
            background: rgba(255, 255, 255, 0.3);
            top: -100px;
            left: -100px;
        }

        .orb-2 {
            width: 400px;
            height: 400px;
            background: rgba(255, 255, 255, 0.2);
            bottom: -150px;
            right: -100px;
            animation-delay: -7s;
        }

        @keyframes float {

            0%,
            100% {
                transform: translate(0, 0) scale(1);
            }

            33% {
                transform: translate(30px, -30px) scale(1.05);
            }

            66% {
                transform: translate(-20px, 20px) scale(0.95);
            }
        }

        .container {
            width: 90%;
            max-width: 520px;
            background: var(--glass-bg);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            padding: 2.5rem;
            border-radius: 28px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .container:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15);
        }

        /* Logo åŒºåŸŸ */
        .logo-section {
            text-align: center;
            margin-bottom: 2rem;
        }

        .logo-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 1rem;
            background: linear-gradient(135deg, var(--primary), #5856d6);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 16px var(--primary-glow);
        }

        .logo-icon svg {
            width: 36px;
            height: 36px;
            fill: white;
        }

        h1 {
            font-size: 22px;
            font-weight: 700;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, var(--text-main), var(--text-sec));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 13px;
            color: var(--text-sec);
            margin-top: 4px;
        }

        .input-group {
            margin-bottom: 1.25rem;
        }

        label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-sec);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        label svg {
            width: 14px;
            height: 14px;
            fill: currentColor;
            opacity: 0.7;
        }

        input[type="text"],
        input[type="password"],
        input[type="number"],
        textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid transparent;
            background: rgba(120, 120, 128, 0.08);
            border-radius: 14px;
            font-size: 15px;
            color: var(--text-main);
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: inherit;
        }

        input:hover,
        textarea:hover {
            background: rgba(120, 120, 128, 0.12);
        }

        input:focus,
        textarea:focus {
            outline: none;
            background: rgba(120, 120, 128, 0.05);
            border-color: var(--primary);
            box-shadow: 0 0 0 4px var(--primary-glow);
        }

        textarea {
            resize: vertical;
            min-height: 90px;
            line-height: 1.5;
        }

        .switch-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            margin-bottom: 1rem;
            background: rgba(120, 120, 128, 0.06);
            border-radius: 14px;
            transition: background 0.2s;
        }

        .switch-row:hover {
            background: rgba(120, 120, 128, 0.1);
        }

        .switch-label {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .switch-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-main);
        }

        .switch-title svg {
            width: 18px;
            height: 18px;
            fill: var(--primary);
        }

        .switch-desc {
            font-size: 12px;
            color: var(--text-sec);
            font-weight: 400;
            padding-left: 26px;
        }

        /* iOS é£æ ¼å¼€å…³ */
        .toggle-switch {
            position: relative;
            width: 52px;
            height: 32px;
            appearance: none;
            background: rgba(120, 120, 128, 0.24);
            border-radius: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            outline: none;
            flex-shrink: 0;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 28px;
            height: 28px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch:checked {
            background: var(--primary);
        }

        .toggle-switch:checked::after {
            transform: translateX(20px);
        }

        .toggle-switch:focus {
            box-shadow: 0 0 0 4px var(--primary-glow);
        }

        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), #5856d6);
            color: white;
            box-shadow: 0 4px 16px var(--primary-glow);
        }

        .btn-primary:hover {
            box-shadow: 0 6px 24px var(--primary-glow);
            transform: translateY(-1px);
        }

        .hidden {
            display: none;
            opacity: 0;
        }

        .fade-in {
            animation: fadeIn 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(16px) scale(0.98);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        #message {
            margin-top: 1rem;
            text-align: center;
            font-size: 14px;
            min-height: 24px;
            padding: 8px;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .success {
            color: var(--success);
            background: rgba(52, 199, 89, 0.1);
        }

        .error {
            color: var(--danger);
            background: rgba(255, 59, 48, 0.1);
        }

        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
            background: rgba(120, 120, 128, 0.1);
            color: var(--text-sec);
            margin-left: 8px;
            text-transform: uppercase;
        }

        .section-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--glass-border), transparent);
            margin: 1.5rem 0;
        }

        .hint-text {
            font-size: 11px;
            color: var(--text-sec);
            margin-top: 6px;
            padding-left: 2px;
        }

        /* éª¨æ¶åŠ è½½åŠ¨ç”» */
        .skeleton {
            background: linear-gradient(90deg, rgba(120, 120, 128, 0.1) 25%, rgba(120, 120, 128, 0.2) 50%, rgba(120, 120, 128, 0.1) 75%);
            background-size: 200% 100%;
            animation: skeleton 1.5s infinite;
            border-radius: 8px;
        }

        @keyframes skeleton {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }

        /* å“åº”å¼ */
        @media (max-width: 480px) {
            .container {
                padding: 1.75rem;
                border-radius: 24px;
            }

            .logo-icon {
                width: 56px;
                height: 56px;
            }

            h1 {
                font-size: 20px;
            }
        }
        /* è¯­è¨€åˆ‡æ¢æŒ‰é’® */
        .lang-switch {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-sec);
            transition: all 0.2s;
            z-index: 100;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: var(--glass-shadow);
        }
        .lang-switch:hover {
            color: var(--primary);
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-1px);
        }
    </style>
</head>

<body>
    <!-- åŠ¨æ€èƒŒæ™¯ -->
    <div class="bg-gradient"></div>
    <div class="floating-orb orb-1"></div>
    <div class="floating-orb orb-2"></div>

    <!-- è¯­è¨€åˆ‡æ¢ -->
    <button class="lang-switch" onclick="toggleLanguage()" id="lang-btn">
        <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
            <path d="M12.87 15.07l-2.54-2.51.03-.03A17.52 17.52 0 0014.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/>
        </svg>
        <span id="lang-text">English</span>
    </button>

    <!-- ç™»å½•åŒºåŸŸ -->
    <div class="container" id="login-section">
        <div class="logo-section">
            <div class="logo-icon">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z" />
                </svg>
            </div>
            <h1 data-i18n="login.title">ç®¡ç†é¢æ¿</h1>
            <p class="subtitle" data-i18n="login.subtitle">EdgeOne éšæœºå›¾ç‰‡</p>
        </div>

        <div class="input-group">
            <label>
                <svg viewBox="0 0 24 24">
                    <path
                        d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z" />
                </svg>
                <span data-i18n="login.password">å¯†ç </span>
            </label>
            <input type="password" id="password" placeholder="è¯·è¾“å…¥ç®¡ç†å¯†ç " data-i18n-placeholder="login.passwordPlaceholder" autocomplete="current-password">
        </div>

        <button class="btn btn-primary" onclick="login()">
            <svg viewBox="0 0 24 24">
                <path
                    d="M11 7L9.6 8.4l2.6 2.6H2v2h10.2l-2.6 2.6L11 17l5-5-5-5zm9 12h-8v2h8c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-8v2h8v14z" />
            </svg>
            <span data-i18n="login.signIn">ç™»å½•</span>
        </button>
        <div id="login-msg" class="error" style="text-align:center; margin-top:12px;"></div>
    </div>

    <!-- Dashboard åŒºåŸŸ -->
    <div class="container hidden" id="dashboard-section">
        <div class="logo-section" style="margin-bottom: 1.5rem;">
            <h1><span data-i18n="dashboard.title">æ§åˆ¶é¢æ¿</span> <span id="source-badge" class="badge" data-i18n="dashboard.loading">åŠ è½½ä¸­...</span></h1>
        </div>

        <div class="switch-row">
            <div class="switch-label">
                <span class="switch-title">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z" />
                    </svg>
                    <span data-i18n="dashboard.publicAccess">å…¨å±€å…¬å¼€è®¿é—®</span>
                </span>
                <span class="switch-desc" data-i18n="dashboard.publicAccessDesc">å…è®¸ä»»ä½•äººè®¿é—®å›¾ç‰‡</span>
            </div>
            <input type="checkbox" id="public-access" class="toggle-switch">
        </div>

        <div class="input-group">
            <label>
                <svg viewBox="0 0 24 24">
                    <path
                        d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z" />
                </svg>
                <span data-i18n="dashboard.whitelist">ç™½åå•åŸŸå</span>
            </label>
            <input type="text" id="whitelist" placeholder="example.com, blog.me" data-i18n-placeholder="dashboard.whitelistPlaceholder">
            <p class="hint-text" data-i18n="dashboard.whitelistHint">é€—å·åˆ†éš”çš„å…è®¸åŸŸååˆ—è¡¨</p>
        </div>

        <div class="input-group">
            <label>
                <svg viewBox="0 0 24 24">
                    <path
                        d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z" />
                </svg>
                <span data-i18n="dashboard.publicImages">å…¬å¼€å›¾ç‰‡</span>
            </label>
            <textarea id="public-images" placeholder="banner.jpg, logo.png" data-i18n-placeholder="dashboard.publicImagesPlaceholder"></textarea>
            <p class="hint-text" data-i18n="dashboard.publicImagesHint">è¿™äº›å›¾ç‰‡å°†ç»•è¿‡é˜²ç›—é“¾ä¿æŠ¤</p>
        </div>

        <div class="section-divider"></div>

        <div class="switch-row">
            <div class="switch-label">
                <span class="switch-title">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z" />
                    </svg>
                    <span data-i18n="dashboard.ddosMode">DDoS é˜²æŠ¤æ¨¡å¼</span>
                </span>
                <span class="switch-desc" data-i18n="dashboard.ddosModeDesc">å¯ç”¨è¾¹ç¼˜ç¼“å­˜å’Œä¸¥æ ¼æ£€æŸ¥</span>
            </div>
            <input type="checkbox" id="ddos-mode" class="toggle-switch">
        </div>

        <div class="input-group" id="cache-group">
            <label>
                <svg viewBox="0 0 24 24">
                    <path
                        d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z" />
                </svg>
                <span data-i18n="dashboard.cacheTimeout">ç¼“å­˜è¶…æ—¶ï¼ˆç§’ï¼‰</span>
            </label>
            <input type="number" id="ddos-cache" value="5" min="1" max="60">
        </div>

        <button class="btn btn-primary" onclick="saveConfig()" id="save-btn">
            <svg viewBox="0 0 24 24">
                <path
                    d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z" />
            </svg>
            <span data-i18n="dashboard.save">ä¿å­˜æ›´æ”¹</span>
        </button>
        <div id="message"></div>
    </div>

    <script>
        const i18n = {
            zh: {
                login: {
                    title: 'ç®¡ç†é¢æ¿',
                    subtitle: 'EdgeOne éšæœºå›¾ç‰‡',
                    password: 'å¯†ç ',
                    passwordPlaceholder: 'è¯·è¾“å…¥ç®¡ç†å¯†ç ',
                    signIn: 'ç™»å½•',
                    verifying: 'éªŒè¯ä¸­...',
                    invalidPassword: 'å¯†ç é”™è¯¯',
                    networkError: 'ç½‘ç»œé”™è¯¯'
                },
                dashboard: {
                    title: 'æ§åˆ¶é¢æ¿',
                    loading: 'åŠ è½½ä¸­...',
                    publicAccess: 'å…¨å±€å…¬å¼€è®¿é—®',
                    publicAccessDesc: 'å…è®¸ä»»ä½•äººè®¿é—®å›¾ç‰‡',
                    whitelist: 'ç™½åå•åŸŸå',
                    whitelistPlaceholder: 'example.com, blog.me',
                    whitelistHint: 'é€—å·åˆ†éš”çš„å…è®¸åŸŸååˆ—è¡¨',
                    publicImages: 'å…¬å¼€å›¾ç‰‡',
                    publicImagesPlaceholder: 'banner.jpg, logo.png',
                    publicImagesHint: 'è¿™äº›å›¾ç‰‡å°†ç»•è¿‡é˜²ç›—é“¾ä¿æŠ¤',
                    ddosMode: 'DDoS é˜²æŠ¤æ¨¡å¼',
                    ddosModeDesc: 'å¯ç”¨è¾¹ç¼˜ç¼“å­˜å’Œä¸¥æ ¼æ£€æŸ¥',
                    cacheTimeout: 'ç¼“å­˜è¶…æ—¶ï¼ˆç§’ï¼‰',
                    save: 'ä¿å­˜æ›´æ”¹',
                    saving: 'ä¿å­˜ä¸­...',
                    saved: 'âœ“ é…ç½®å·²ä¿å­˜ï¼',
                    saveFailed: 'ä¿å­˜å¤±è´¥: ',
                    readOnly: 'ğŸ”’ åªè¯»æ¨¡å¼ï¼ˆç¯å¢ƒå˜é‡é…ç½®ï¼‰'
                },
                langName: 'English' // åˆ‡æ¢æŒ‰é’®æ˜¾ç¤ºçš„æ–‡å­—ï¼ˆTarget Languageï¼‰
            },
            en: {
                login: {
                    title: 'Admin Panel',
                    subtitle: 'EdgeOne Random Photo',
                    password: 'Password',
                    passwordPlaceholder: 'Enter admin password',
                    signIn: 'Sign In',
                    verifying: 'Verifying...',
                    invalidPassword: 'Invalid Password',
                    networkError: 'Network Error',
                },
                dashboard: {
                    title: 'Dashboard',
                    loading: 'Loading...',
                    publicAccess: 'Global Public Access',
                    publicAccessDesc: 'Allow anyone to access images',
                    whitelist: 'Whitelist Domains',
                    whitelistPlaceholder: 'example.com, blog.me',
                    whitelistHint: 'Comma separated list of allowed domains',
                    publicImages: 'Public Images',
                    publicImagesPlaceholder: 'banner.jpg, logo.png',
                    publicImagesHint: 'These images bypass hotlink protection',
                    ddosMode: 'DDoS Defense Mode',
                    ddosModeDesc: 'Enable edge caching and strict checks',
                    cacheTimeout: 'Cache Timeout (Seconds)',
                    save: 'Save Changes',
                    saving: 'Saving...',
                    saved: 'âœ“ Configuration Saved!',
                    saveFailed: 'Failed: ',
                    readOnly: 'ğŸ”’ Read-Only (Environment Variables)'
                },
                langName: 'ä¸­æ–‡'
            }
        };

        let currentLang = localStorage.getItem('admin_lang') || 'zh';
        let authToken = '';

        // åˆå§‹åŒ–è¯­è¨€
        setLanguage(currentLang);

        function toggleLanguage() {
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            setLanguage(currentLang);
            localStorage.setItem('admin_lang', currentLang);
        }

        function setLanguage(lang) {
            const texts = i18n[lang];
            
            // æ›´æ–°åˆ‡æ¢æŒ‰é’®æ–‡æœ¬
            document.getElementById('lang-text').innerText = texts.langName;

            // æ›´æ–°æ‰€æœ‰å¸¦æœ‰ data-i18n çš„å…ƒç´ 
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                const val = getNestedValue(texts, key);
                if (val) el.innerText = val;
            });

            // æ›´æ–° placeholders
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                const val = getNestedValue(texts, key);
                if (val) el.placeholder = val;
            });
        }

        function getNestedValue(obj, path) {
            return path.split('.').reduce((prev, curr) => prev ? prev[curr] : null, obj);
        }

        function getText(key) {
             return getNestedValue(i18n[currentLang], key);
        }

        async function login() {
            const pwd = document.getElementById('password').value;
            if (!pwd) return;

            authToken = 'Bearer ' + pwd;

            const btn = document.querySelector('#login-section .btn');
            const originalHTML = btn.innerHTML;
            // è¿™é‡Œçš„ Verifying... ä¹Ÿéœ€è¦å›½é™…åŒ–ï¼Œä½†ä¸ºäº†ä¿ç•™ SVG åŠ¨ç”»ï¼Œæˆ‘ä»¬åªæ›¿æ¢æ–‡æœ¬èŠ‚ç‚¹
            // ä¸è¿‡æ›´ç®€å•çš„æ–¹å¼æ˜¯æ¯æ¬¡éƒ½é‡ç½®innerHTML
            
            const verifyingText = getText('login.verifying');
            
            btn.innerHTML = '<svg class="spinner" viewBox="0 0 24 24" style="animation: spin 1s linear infinite;"><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/></svg>' + ' ' + verifyingText;
            btn.classList.add('loading');

            try {
                const res = await fetch('/api/admin', {
                    headers: { 'Authorization': authToken }
                });

                if (res.ok) {
                    const config = await res.json();
                    showDashboard(config);
                } else {
                    document.getElementById('login-msg').innerText = getText('login.invalidPassword');
                    authToken = '';
                }
            } catch (e) {
                document.getElementById('login-msg').innerText = getText('login.networkError');
            } finally {
                // æ¢å¤åŸå§‹æŒ‰é’®å†…å®¹ï¼Œå¹¶ç¡®ä¿æ–‡æœ¬æ­£ç¡®
                btn.classList.remove('loading');
                // å› ä¸º login() æ‰§è¡Œå®Œå¯èƒ½è¯­è¨€å·²ç»åˆ‡æ¢äº†ï¼ˆè™½ç„¶ä¸å¤ªå¯èƒ½åœ¨ login è¿‡ç¨‹ä¸­åˆ‡æ¢ï¼‰ï¼Œ
                // æœ€å¥½æ˜¯é‡æ–°æ¸²æŸ“æŒ‰é’®å†…å®¹
                const signInText = getText('login.signIn');
                btn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M11 7L9.6 8.4l2.6 2.6H2v2h10.2l-2.6 2.6L11 17l5-5-5-5zm9 12h-8v2h8c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-8v2h8v14z" /></svg> ' + `<span data-i18n="login.signIn">${signInText}</span>`;
            }
        }

        function showDashboard(config) {
            document.getElementById('login-section').classList.add('hidden');
            const dash = document.getElementById('dashboard-section');
            dash.classList.remove('hidden');
            dash.classList.add('fade-in');

            document.getElementById('public-access').checked = config.publicAccess;
            document.getElementById('whitelist').value = config.whitelist.join(', ');
            document.getElementById('ddos-mode').checked = config.ddosMode;
            document.getElementById('ddos-cache').value = config.ddosCacheTimeout;
            document.getElementById('public-images').value = (config.publicImages || []).join(', ');

            const badge = document.getElementById('source-badge');
            // æ ¹æ® kvBound å’Œ source ç»„åˆæ˜¾ç¤ºæ›´å‡†ç¡®çš„çŠ¶æ€
            if (config.kvBound && config.source === 'KV') {
                badge.innerText = 'KV Mode';
                badge.style.background = 'rgba(52, 199, 89, 0.15)';
                badge.style.color = 'var(--success)';
            } else if (config.kvBound && config.source === 'ENV') {
                // KV å·²ç»‘å®šä½†æ•°æ®ä¸ºç©ºï¼Œä¿å­˜åå°†åˆ‡æ¢ä¸º KV Mode
                badge.innerText = 'KV Ready';
                badge.style.background = 'rgba(0, 122, 255, 0.15)';
                badge.style.color = 'var(--primary)';
            } else {
                badge.innerText = 'Read-Only';
                badge.style.background = 'rgba(255, 59, 48, 0.15)';
                badge.style.color = 'var(--danger)';
            }
            
            // å…³é”®ä¿®å¤ï¼šæ ¹æ® kvBound åˆ¤æ–­æ˜¯å¦ç¦ç”¨ï¼Œè€Œé source
            // å³ä½¿ source æ˜¯ ENVï¼Œåªè¦ kvBound ä¸º trueï¼Œå°±å…è®¸ç¼–è¾‘å¹¶åˆå§‹åŒ– KV
            if (!config.kvBound) {
                const elements = document.querySelectorAll('#dashboard-section input, #dashboard-section textarea, #dashboard-section button:not(.lang-switch)');
                elements.forEach(el => el.disabled = true);
                showMessage(getText('dashboard.readOnly'), '');
                document.getElementById('message').style.color = 'var(--text-sec)';
                document.getElementById('message').style.background = 'transparent';
            }
        }

        async function saveConfig() {
            const btn = document.getElementById('save-btn');
            const savingText = getText('dashboard.saving');
            
            btn.innerHTML = '<svg viewBox="0 0 24 24" style="animation: spin 1s linear infinite;"><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/></svg> ' + savingText;
            btn.classList.add('loading');

            const publicAccess = document.getElementById('public-access').checked;
            const whitelistStr = document.getElementById('whitelist').value;
            const whitelist = whitelistStr.split(',').map(s => s.trim()).filter(s => s);

            const ddosMode = document.getElementById('ddos-mode').checked;
            const ddosCacheTimeout = parseInt(document.getElementById('ddos-cache').value);

            const publicImagesStr = document.getElementById('public-images').value;
            const publicImages = publicImagesStr.split(',').map(s => s.trim()).filter(s => s);

            try {
                const res = await fetch('/api/admin', {
                    method: 'POST',
                    headers: {
                        'Authorization': authToken,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ publicAccess, whitelist, ddosMode, ddosCacheTimeout, publicImages })
                });

                if (res.ok) {
                    showMessage(getText('dashboard.saved'), 'success');
                } else {
                    const msg = await res.text();
                    showMessage(getText('dashboard.saveFailed') + msg, 'error');
                }
            } catch (e) {
                showMessage(getText('login.networkError') + ': ' + e.message, 'error');
            } finally {
                btn.classList.remove('loading');
                const saveText = getText('dashboard.save');
                btn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z" /></svg> ' + `<span data-i18n="dashboard.save">${saveText}</span>`;
            }
        }

        function showMessage(msg, type) {
            const el = document.getElementById('message');
            el.innerText = msg;
            el.className = type;
            if (type) {
                setTimeout(() => {
                    el.innerText = '';
                    el.className = '';
                }, 3000);
            }
        }

        document.getElementById('password').addEventListener('keyup', function (event) {
            if (event.key === 'Enter') {
                login();
            }
        });

        // æ·»åŠ  spin åŠ¨ç”»
        const style = document.createElement('style');
        style.textContent = '@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }';
        document.head.appendChild(style);
    </script>
</body>

</html>